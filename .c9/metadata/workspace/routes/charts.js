{"changed":true,"filter":false,"title":"charts.js","tooltip":"/routes/charts.js","value":"var express = require('express');\nvar async = require(\"async\");\nvar router = express.Router();\n\nrouter.get('/', function(req, res, next) {\n    res.render(\"index.html\");\n});\n\n/*\n\nrouter.get('/', function(req, res, next) {\n\n    var collection = req.collection;\n    var stockname = req.query.stockname;\n    if (!stockname) {\n        stockname = \"SET\"\n    }\n    var results = [];\n    var asyncTask = []\n    asyncTask.push(getStockData(collection, stockname));\n    async.series(asyncTask\n        /*\n        async.series([\n            //Load user to get userId first\n            function(callback) {\n                collection.find({\n                    name: stockname\n                }).sort({\n                    date: 1\n                }).toArray(function(err, items) {\n                    console.log(\"getStockData() invoked\");\n                    for (var pos in items) {\n                        results.push(items[pos]);\n                    }\n                    // console.log(\"getStockData() = \"+JSON.stringify(array));\n                    callback();\n                });\n            }\n        \n        , function(err) { //This function gets called after the two tasks have called their \"task callbacks\"\n            if (err) return next(err);\n            console.log(JSON.stringify(results));\n            res.render('charts', {\"data\":results});\n            console.log(stockname);\n        });\n    //function for factoring asyncTask creation\n    function getStockData(collection, stockname) {\n\n        return function(callback) {\n            var array = [];\n            var stockdata={};\n            collection.find({\n                name: stockname\n            }).sort({\n                date: 1\n            }).toArray(function(err, items) {\n                console.log(\"getStockData() invoked\");\n                \n                for (var pos in items) {\n                    delete items[pos].name;\n                    delete items[pos]._id;\n                    array.push(items[pos])\n\n                }\n                stockdata[\"stockname\"]=stockname;\n                stockdata[\"data\"]=array;\n                results.push(stockdata);\n                console.log(\"getStockData() = \" + JSON.stringify(stockdata));\n                callback();\n            });\n        }\n    };\n});\n\n*/\n\nmodule.exports = router;\n","undoManager":{"mark":23,"position":24,"stack":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":19},"end":{"row":29,"column":29}},"text":"graphpanel"},{"action":"insertText","range":{"start":{"row":29,"column":19},"end":{"row":29,"column":20}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":20},"end":{"row":29,"column":21}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":21},"end":{"row":29,"column":22}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":22},"end":{"row":29,"column":23}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":23},"end":{"row":29,"column":24}},"text":"x"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":27},"end":{"row":29,"column":28}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":27},"end":{"row":29,"column":28}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":28},"end":{"row":29,"column":29}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":28},"end":{"row":29,"column":29}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":27},"end":{"row":29,"column":28}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":26},"end":{"row":29,"column":27}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":25},"end":{"row":29,"column":26}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":24},"end":{"row":29,"column":25}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":23},"end":{"row":29,"column":24}},"text":"x"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":22},"end":{"row":29,"column":23}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":21},"end":{"row":29,"column":22}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":20},"end":{"row":29,"column":21}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":29,"column":19},"end":{"row":29,"column":20}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":19},"end":{"row":29,"column":20}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":20},"end":{"row":29,"column":21}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":21},"end":{"row":29,"column":22}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":22},"end":{"row":29,"column":23}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":23},"end":{"row":29,"column":24}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":29,"column":24},"end":{"row":29,"column":25}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":4,"column":0},"end":{"row":5,"column":0}},"nl":"\n","lines":["/*"]},{"action":"removeLines","range":{"start":{"row":7,"column":0},"end":{"row":12,"column":0}},"nl":"\n","lines":["router.get('/test', function(req, res, next) {","    res.render(\"test.ejs\");","});","*/",""]},{"action":"insertText","range":{"start":{"row":7,"column":0},"end":{"row":8,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":8,"column":0},"end":{"row":8,"column":2}},"text":"/*"},{"action":"insertText","range":{"start":{"row":20,"column":26},"end":{"row":21,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":21,"column":0},"end":{"row":39,"column":0}},"lines":["        /*","        async.series([","            //Load user to get userId first","            function(callback) {","                collection.find({","                    name: stockname","                }).sort({","                    date: 1","                }).toArray(function(err, items) {","                    console.log(\"getStockData() invoked\");","                    for (var pos in items) {","                        results.push(items[pos]);","                    }","                    // console.log(\"getStockData() = \"+JSON.stringify(array));","                    callback();","                });","            }","        "]},{"action":"insertText","range":{"start":{"row":39,"column":0},"end":{"row":39,"column":8}},"text":"        "},{"action":"insertText","range":{"start":{"row":40,"column":8},"end":{"row":40,"column":11}},"text":"   "},{"action":"insertText","range":{"start":{"row":40,"column":11},"end":{"row":40,"column":12}},"text":" "},{"action":"insertText","range":{"start":{"row":41,"column":0},"end":{"row":41,"column":4}},"text":"    "},{"action":"removeText","range":{"start":{"row":42,"column":5},"end":{"row":42,"column":32}},"text":"  // res.render('charts', {"},{"action":"removeText","range":{"start":{"row":42,"column":5},"end":{"row":43,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":43,"column":0},"end":{"row":43,"column":12}},"text":"            "},{"action":"removeText","range":{"start":{"row":42,"column":34},"end":{"row":43,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":42,"column":34},"end":{"row":42,"column":35}},"text":"\""},{"action":"insertText","range":{"start":{"row":42,"column":39},"end":{"row":42,"column":40}},"text":"\""},{"action":"removeText","range":{"start":{"row":42,"column":41},"end":{"row":42,"column":42}},"text":" "},{"action":"insertText","range":{"start":{"row":42,"column":48},"end":{"row":42,"column":51}},"text":"});"},{"action":"removeText","range":{"start":{"row":43,"column":4},"end":{"row":43,"column":11}},"text":"    });"},{"action":"removeText","range":{"start":{"row":43,"column":4},"end":{"row":44,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":44,"column":0},"end":{"row":44,"column":4}},"text":"    "},{"action":"removeText","range":{"start":{"row":50,"column":25},"end":{"row":50,"column":28}},"text":" = "},{"action":"insertText","range":{"start":{"row":50,"column":25},"end":{"row":50,"column":26}},"text":"="},{"action":"insertText","range":{"start":{"row":57,"column":0},"end":{"row":57,"column":16}},"text":"                "},{"action":"removeText","range":{"start":{"row":64,"column":38},"end":{"row":64,"column":41}},"text":" = "},{"action":"insertText","range":{"start":{"row":64,"column":38},"end":{"row":64,"column":39}},"text":"="},{"action":"removeText","range":{"start":{"row":65,"column":33},"end":{"row":65,"column":36}},"text":" = "},{"action":"insertText","range":{"start":{"row":65,"column":33},"end":{"row":65,"column":34}},"text":"="},{"action":"insertText","range":{"start":{"row":74,"column":0},"end":{"row":74,"column":2}},"text":"*/"}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":10,"column":20},"end":{"row":10,"column":20},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1414250512000}